import org.gradle.internal.jvm.Jvm

import java.time.ZoneId
import java.time.ZonedDateTime
import java.time.format.DateTimeFormatter

def gitBranch() {
    def branch = ""
    def proc = "git rev-parse --abbrev-ref HEAD".execute()
    proc.in.eachLine { line -> branch = line }
    proc.err.eachLine { line -> println line }
    proc.waitFor()
    branch
}

println "Using Gradle version: $gradle.gradleVersion"
println "Compiling with: "+ Jvm.current()

ext {
    jarNumber = '1.0'  // ENG-0000: Demo reporting artifact

    workingBranch = project.hasProperty('src_branch')? project.property('src_branch'):  gitBranch()
    releaseDate = ZonedDateTime.now(ZoneId.of("America/New_York")).format(DateTimeFormatter.ofPattern("yyyy-MM-dd-HH:mm:ss"))

    dependencyKey = "$projectKey$jarType"
    jarVersion = "$jarNumber$dependencyKey"

    //Dependencies numbers
    springBootVersion = '3.2.6'
    springDependencyManagementVersion = '1.1.4'
    springCloudVersion = '2023.0.0'
    springAWSCloudVersion = '2.4.4'
    mchCommonsVersion = '1.5.11'
    mchNotificationVersion = '1.5'

    mapstructVersion = '1.5.5.Final'
    lombokMapstructVersion = '0.2.0'
    springOpenAPIVersion = '2.4.0'
    buckect4JVersion = '0.10.3'

    //javersVersion = '6.2.3'
    jsonwebtokenVersion = '0.11.2'
    mockWebserverVersion = '4.9.0'
    snowflakeDriverVersion = '3.13.29'

    //Testing
    mockitoVersion = '4.12'
    springAddonsVersion = '7.6.11'
    mchCoveragePluginVersion = '1.1.2'
}

println "Working BRANCH: ${workingBranch}"

println "=========== MCH Artifact's versions ====================="
println "jarVersion = $jarVersion"

println "=========== MCH library's versions ====================="
println "mchCoveragePluginVersion = $mchCoveragePluginVersion"

println "=========== Third party library's versions ============="
println "springBootVersion = $springBootVersion"
println "springCloudVersion = $springCloudVersion"
println "mchCommonsVersion = $mchCommonsVersion"
println "buckect4JVersion = $buckect4JVersion"
println "mapstructVersion = $mapstructVersion"
println "lombokMapstructVersion = $lombokMapstructVersion"
println "snowflakeDriverVersion = $snowflakeDriverVersion"
println "mockWebserverVersion = $mockWebserverVersion"
println "mockitoVersion = $mockitoVersion"
println "springAddonsVersion = $springAddonsVersion"

println "releaseDate = $releaseDate"
